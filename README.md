# Nexus Ansible í”„ë¡œì íŠ¸

ì´ í”„ë¡œì íŠ¸ëŠ” Ansibleì„ ì‚¬ìš©í•˜ì—¬ Nexus ë§ˆì´ë‹ ë…¸ë“œë“¤ì„ ìë™ìœ¼ë¡œ ë°°í¬í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- **ìë™ ë°°í¬**: Nexus ë§ˆì´ë‹ ë…¸ë“œë¥¼ ì›ê²© ì„œë²„ì— ìë™ìœ¼ë¡œ ì„¤ì¹˜ ë° ì„¤ì •
- **ì¼ê´„ ê´€ë¦¬**: ì—¬ëŸ¬ ì„œë²„ë¥¼ ë™ì‹œì— ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì¤‘ì•™í™”ëœ ê´€ë¦¬ ì‹œìŠ¤í…œ
- **ê°„í¸í•œ ëª…ë ¹ì–´**: Makefileì„ í†µí•œ ì§ê´€ì ì¸ ëª…ë ¹ì–´ ì œê³µ
- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: ë…¸ë“œ ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸ ë° ëª¨ë‹ˆí„°ë§
- **ì•ˆì „í•œ ì„¤ì •**: í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•œ ë¯¼ê°í•œ ì •ë³´ ë³´í˜¸

## ğŸ“‹ ìš”êµ¬ì‚¬í•­

### ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

- **Ansible**: 2.9 ì´ìƒ
- **Python**: 3.6 ì´ìƒ
- **ëŒ€ìƒ ì„œë²„**: Ubuntu/Debian ê¸°ë°˜ Linux

### ë„¤íŠ¸ì›Œí¬ ìš”êµ¬ì‚¬í•­

- Ansible ì»¨íŠ¸ë¡¤ ë…¸ë“œì—ì„œ ëŒ€ìƒ ì„œë²„ë¡œì˜ SSH ì ‘ê·¼ ê°€ëŠ¥
- ì¸í„°ë„· ì—°ê²° (GitHubì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ)

## ğŸ› ï¸ ì„¤ì¹˜ ë° ì„¤ì •

### 1. Ansible ì„¤ì¹˜

#### macOS

```bash
brew install ansible
```

#### Ubuntu/Debian

```bash
sudo apt update
sudo apt install -y ansible
```

#### Python (pip)

```bash
pip install ansible
```

### 2. í”„ë¡œì íŠ¸ ì„¤ì •

#### ì´ˆê¸° ì„¤ì •

```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡ 
git clone <repository-url>
cd nexus-ansible

# 2. ì„¤ì • íŒŒì¼ ìƒì„±
cp group_vars/miners.yml.example group_vars/miners.yml
cp inventory.ini.example inventory.ini
```

#### ì„œë²„ ì ‘ì† ì •ë³´ ì„¤ì •

**group_vars/miners.yml** íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ ì„œë²„ ì ‘ì† ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```yaml
# ì„œë²„ ì ‘ì† ì •ë³´ ì„¤ì •
ansible_user: root
ansible_ssh_pass: <password> # ì‹¤ì œ ì„œë²„ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
```

#### ì„œë²„ ëª©ë¡ ì„¤ì •

**inventory.ini** íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ ê´€ë¦¬í•  ì„œë²„ë“¤ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

```ini
[miners]
# í˜•ì‹: ì„œë²„ëª… ansible_host=IPì£¼ì†Œ node_id=ë…¸ë“œID threads=ì±„êµ´ìŠ¤ë ˆë“œìˆ˜
server1 ansible_host=192.168.1.100 node_id=7006171 threads=1
server2 ansible_host=192.168.1.101 node_id=7096264 threads=1
```

**ì„¤ì • ë³€ìˆ˜ ì„¤ëª…:**

- `node_id`: Nexus ë§ˆì´ë‹ ë…¸ë“œ ID
- `threads`: ê° ë…¸ë“œì—ì„œ ì‚¬ìš©í•  CPU ìŠ¤ë ˆë“œ ìˆ˜

## ğŸ”§ ì‚¬ìš©ë²•

### Makefile ëª…ë ¹ì–´ (ê¶Œì¥)

```bash
# ë„ì›€ë§ ë³´ê¸°
make help

# ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸
make ping

# Nexus ë°°í¬ (ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”)
make deploy

# Nexus ë…¸ë“œ ìƒíƒœ í™•ì¸
make status

# Nexus ë…¸ë“œ ì¬ì‹œì‘ (ê¸°ì¡´ ì„¤ì •ìœ¼ë¡œ)
make restart

# ì‹¤ì‹œê°„ ë…¸ë“œ ëª¨ë‹ˆí„°ë§
make monitor

# ì‹œìŠ¤í…œ ìƒíƒœ ì²´í¬
make check

# ì •ë¦¬ ì‘ì—…
make cleanup

# ê³ ê¸‰ ë°°í¬ ì˜µì…˜
make deploy-fast   # ê³ ì† ë°°í¬ (20ê°œ ë³‘ë ¬ ì²˜ë¦¬)
make deploy-batch  # ë°°ì¹˜ ë°°í¬ (5ê°œì”© ê·¸ë£¹ ì²˜ë¦¬)

# íŠ¹ì • ì„œë²„ì—ë§Œ ì‹¤í–‰ (ì˜ˆ: make ping-single SERVER=server1)
make ping-single SERVER=server1
make deploy-single SERVER=server1
make status-single SERVER=server1
make restart-single SERVER=server1
```

### ì§ì ‘ Ansible ëª…ë ¹ì–´ ì‚¬ìš©

```bash
# ëª¨ë“  ì„œë²„ì— ë°°í¬
ansible-playbook -i inventory.ini playbooks/nexus.yml

# íŠ¹ì • ì„œë²„ì—ë§Œ ë°°í¬
ansible-playbook -i inventory.ini playbooks/nexus.yml --limit server1

# ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
ansible miners -i inventory.ini -m ping

# ì„œë²„ ìƒíƒœ í™•ì¸
ansible miners -i inventory.ini -m shell -a "bash /root/nexus_multi.sh status"
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
nexus-ansible/
â”œâ”€â”€ group_vars/
â”‚   â”œâ”€â”€ miners.yml.example    # ì„œë²„ ì ‘ì† ì •ë³´ ì˜ˆì‹œ
â”‚   â””â”€â”€ miners.yml           # ì‹¤ì œ ì„œë²„ ì ‘ì† ì •ë³´ (Gitì—ì„œ ì œì™¸)
â”œâ”€â”€ inventory.ini.example     # ì„œë²„ ëª©ë¡ ì˜ˆì‹œ
â”œâ”€â”€ inventory.ini            # ì‹¤ì œ ì„œë²„ ëª©ë¡ (Gitì—ì„œ ì œì™¸)
â”œâ”€â”€ playbooks/               # Ansible í”Œë ˆì´ë¶ ëª¨ìŒ
â”‚   â”œâ”€â”€ nexus.yml            # ë©”ì¸ ë°°í¬ í”Œë ˆì´ë¶
â”‚   â””â”€â”€ restart.yml          # ì¬ì‹œì‘ í”Œë ˆì´ë¶
â”œâ”€â”€ Makefile                 # í¸ì˜ ëª…ë ¹ì–´ ëª¨ìŒ
â”œâ”€â”€ roles/
â”‚   â””â”€â”€ nexus/              # Nexus ì„¤ì¹˜ ì—­í• 
â”‚       â”œâ”€â”€ tasks/
â”‚       â”‚   â””â”€â”€ main.yml    # ì„¤ì¹˜ ì‘ì—… ì •ì˜
â”‚       â””â”€â”€ files/
â”‚           â”œâ”€â”€ nexus_multi.sh # Nexus ë‹¤ì¤‘ ë…¸ë“œ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”‚           â””â”€â”€ nexus_s3.sh    # Nexus S3 ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (ë°±ì—…ìš©)
â”œâ”€â”€ .gitignore              # Git ì œì™¸ íŒŒì¼ ëª©ë¡
â””â”€â”€ README.md
```

## ğŸ”’ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

âš ï¸ **ì¤‘ìš”**: ë‹¤ìŒ íŒŒì¼ë“¤ì€ ë¯¼ê°í•œ ì •ë³´ë¥¼ í¬í•¨í•˜ë¯€ë¡œ ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”:

- `group_vars/miners.yml` - ì„œë²„ ì ‘ì† ë¹„ë°€ë²ˆí˜¸
- `inventory.ini` - ì„œë²„ IP ì£¼ì†Œ ë° ë…¸ë“œ ID

ì´ íŒŒì¼ë“¤ì€ `.gitignore`ì— í¬í•¨ë˜ì–´ ìˆì–´ ì‹¤ìˆ˜ë¡œ ì»¤ë°‹ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

## ğŸ“ ì„¤ì • ì˜ˆì‹œ

### ë‹¨ì¼ ì„œë²„ ì„¤ì •

```ini
[miners]
my-server ansible_host=203.0.113.10 node_id=1234567 threads=1
```

### ë‹¤ì¤‘ ì„œë²„ ì„¤ì •

```ini
[miners]
server1 ansible_host=203.0.113.10 node_id=1234567 threads=1
server2 ansible_host=203.0.113.11 node_id=1234568 threads=2
server3 ansible_host=203.0.113.12 node_id=1234569 threads=4
```

## âš¡ ì„±ëŠ¥ ìµœì í™”

### ë³‘ë ¬ ì²˜ë¦¬ ì„¤ì •

ì´ í”„ë¡œì íŠ¸ëŠ” ëŒ€ê·œëª¨ ì„œë²„ ë°°í¬ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì„±ëŠ¥ ìµœì í™”ê°€ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

#### ê¸°ë³¸ ìµœì í™”

- **ë³‘ë ¬ ì²˜ë¦¬**: ê¸°ë³¸ 10ê°œ ì„œë²„ ë™ì‹œ ì²˜ë¦¬
- **SSH ìµœì í™”**: ControlMasterì™€ pipelining í™œì„±í™”
- **íƒ€ì„ì•„ì›ƒ ìµœì í™”**: ë¶ˆí•„ìš”í•œ ëŒ€ê¸° ì‹œê°„ ë‹¨ì¶•
- **Fact ìºì‹±**: ì‹œìŠ¤í…œ ì •ë³´ ìºì‹±ìœ¼ë¡œ ì†ë„ í–¥ìƒ

#### ë°°í¬ ì˜µì…˜ë³„ ì„±ëŠ¥

```bash
# ê¸°ë³¸ ë°°í¬ (10ê°œ ë³‘ë ¬)
make deploy

# ê³ ì† ë°°í¬ (20ê°œ ë³‘ë ¬) - ëŒ€ê·œëª¨ ì„œë²„ìš©
make deploy-fast

# ë°°ì¹˜ ë°°í¬ (5ê°œì”© ê·¸ë£¹) - ì•ˆì •ì„± ì¤‘ì‹œ
make deploy-batch
```

#### ì„±ëŠ¥ ë¹„êµ

- **ê¸°ì¡´ ë°©ì‹**: ì„œë²„ 1ê°œì”© ìˆœì°¨ ì²˜ë¦¬
- **ìµœì í™” í›„**: ì„œë²„ 10-20ê°œ ë™ì‹œ ì²˜ë¦¬
- **ì˜ˆìƒ ì†ë„ í–¥ìƒ**: 5-10ë°° ë¹ ë¥¸ ë°°í¬

### ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

ê³ ì„±ëŠ¥ ë°°í¬ë¥¼ ìœ„í•œ ê¶Œì¥ ì‚¬í•­:

- **Ansible ì»¨íŠ¸ë¡¤ ë…¸ë“œ**: ìµœì†Œ 4GB RAM, 4ì½”ì–´ CPU
- **ë„¤íŠ¸ì›Œí¬**: ì•ˆì •ì ì¸ ì¸í„°ë„· ì—°ê²°
- **ëŒ€ìƒ ì„œë²„**: SSH ì—°ê²° ì§€ì—° ì‹œê°„ < 100ms

## ğŸ”§ ì‘ì—… íë¦„

### 1. ë°°í¬ ê³¼ì •

1. **ì˜ì¡´ì„± ì„¤ì¹˜**: `screen` íŒ¨í‚¤ì§€ ì„¤ì¹˜
2. **ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬**: `nexus_multi.sh`ë¥¼ ëŒ€ìƒ ì„œë²„ì— ë³µì‚¬
3. **ìë™ ì„¤ì •**: í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•œ ìë™ ì„¤ì •
   - `AUTO_MODE=1`: ìë™ ëª¨ë“œ í™œì„±í™”
   - `NODE_COUNT=1`: ë…¸ë“œ ê°œìˆ˜ ì„¤ì •
   - `THREADS_PER_NODE`: ìŠ¤ë ˆë“œ ìˆ˜ ì„¤ì •
   - `NODE_ID`: ë…¸ë“œ ID ì„¤ì •
4. **ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰**: Nexus ë§ˆì´ë‹ ë…¸ë“œ ì„¤ì¹˜ ë° ì‹œì‘

### 2. ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬

- **ìƒíƒœ í™•ì¸**: `make status`ë¡œ ëª¨ë“  ë…¸ë“œ ìƒíƒœ í™•ì¸
- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: `make monitor`ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- **ì¬ì‹œì‘**: `make restart`ë¡œ ë…¸ë“œ ì¬ì‹œì‘
- **ì‹œìŠ¤í…œ ì²´í¬**: `make check`ë¡œ CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ë¥  í™•ì¸

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ì¶”ê°€ ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš° ì´ìŠˆë¥¼ ë“±ë¡í•´ ì£¼ì„¸ìš”.
